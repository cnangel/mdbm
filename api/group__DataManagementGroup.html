<html lang="en">
<head>
<title>MDBM</title>
<link rel="stylesheet" href="style.css" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head>
<body>
<!-- Generated by Doxygen 1.8.3.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Data Management Group</div>  </div>
</div><!--header-->
<div class="contents">

<p>The Data Management Group contains the API managing data as a whole (not record based), or on a large scale.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmdbm__clean__data.html">mdbm_clean_data</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ga3794540079294a018a304b1ae248006b"><td class="memItemLeft" align="right" valign="top">typedef int(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__DataManagementGroup.html#ga3794540079294a018a304b1ae248006b">mdbm_clean_func</a> )(<a class="el" href="mdbm_8h.html#a80768aab568ca444688a7a1dba7778cd">MDBM</a> *, const <a class="el" href="structdatum.html">datum</a> *, const <a class="el" href="structdatum.html">datum</a> *, struct <a class="el" href="structmdbm__clean__data.html">mdbm_clean_data</a> *, int *quit)</td></tr>
<tr class="separator:ga3794540079294a018a304b1ae248006b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gad01a846213e7f7782f0cf6896b0c24d7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__DataManagementGroup.html#gad01a846213e7f7782f0cf6896b0c24d7">mdbm_compress_tree</a> (<a class="el" href="mdbm_8h.html#a80768aab568ca444688a7a1dba7778cd">MDBM</a> *db)</td></tr>
<tr class="memdesc:gad01a846213e7f7782f0cf6896b0c24d7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compresses the existing MDBM directory.  <a href="#gad01a846213e7f7782f0cf6896b0c24d7">More...</a><br/></td></tr>
<tr class="separator:gad01a846213e7f7782f0cf6896b0c24d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga11a0a94fd2e9ea5a385e3e54205e5831"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__DataManagementGroup.html#ga11a0a94fd2e9ea5a385e3e54205e5831">mdbm_truncate</a> (<a class="el" href="mdbm_8h.html#a80768aab568ca444688a7a1dba7778cd">MDBM</a> *db)</td></tr>
<tr class="memdesc:ga11a0a94fd2e9ea5a385e3e54205e5831"><td class="mdescLeft">&#160;</td><td class="mdescRight">Truncates the MDBM to single empty page.  <a href="#ga11a0a94fd2e9ea5a385e3e54205e5831">More...</a><br/></td></tr>
<tr class="separator:ga11a0a94fd2e9ea5a385e3e54205e5831"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga840fb9d7901f7e82630260850b5efc00"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__DataManagementGroup.html#ga840fb9d7901f7e82630260850b5efc00">mdbm_prune</a> (<a class="el" href="mdbm_8h.html#a80768aab568ca444688a7a1dba7778cd">MDBM</a> *db, int(*prune)(<a class="el" href="mdbm_8h.html#a80768aab568ca444688a7a1dba7778cd">MDBM</a> *, <a class="el" href="structdatum.html">datum</a>, <a class="el" href="structdatum.html">datum</a>, void *), void *param)</td></tr>
<tr class="memdesc:ga840fb9d7901f7e82630260850b5efc00"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prunes an MDBM.  <a href="#ga840fb9d7901f7e82630260850b5efc00">More...</a><br/></td></tr>
<tr class="separator:ga840fb9d7901f7e82630260850b5efc00"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga48eea2ca283989d42e42ca48720ebbd2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__DataManagementGroup.html#ga48eea2ca283989d42e42ca48720ebbd2">mdbm_purge</a> (<a class="el" href="mdbm_8h.html#a80768aab568ca444688a7a1dba7778cd">MDBM</a> *db)</td></tr>
<tr class="memdesc:ga48eea2ca283989d42e42ca48720ebbd2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Purges (removes) all entries from an MDBM.  <a href="#ga48eea2ca283989d42e42ca48720ebbd2">More...</a><br/></td></tr>
<tr class="separator:ga48eea2ca283989d42e42ca48720ebbd2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga555f58328cbba5678b31b302c7478914"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__DataManagementGroup.html#ga555f58328cbba5678b31b302c7478914">mdbm_set_cleanfunc</a> (<a class="el" href="mdbm_8h.html#a80768aab568ca444688a7a1dba7778cd">MDBM</a> *db, <a class="el" href="group__DataManagementGroup.html#ga3794540079294a018a304b1ae248006b">mdbm_clean_func</a> func, void *data)</td></tr>
<tr class="memdesc:ga555f58328cbba5678b31b302c7478914"><td class="mdescLeft">&#160;</td><td class="mdescRight">The specified cleaner function will be called by <a class="el" href="group__DataManagementGroup.html#gaecf6514765dcfa0607706fce430612aa">mdbm_clean</a>.  <a href="#ga555f58328cbba5678b31b302c7478914">More...</a><br/></td></tr>
<tr class="separator:ga555f58328cbba5678b31b302c7478914"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaecf6514765dcfa0607706fce430612aa"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__DataManagementGroup.html#gaecf6514765dcfa0607706fce430612aa">mdbm_clean</a> (<a class="el" href="mdbm_8h.html#a80768aab568ca444688a7a1dba7778cd">MDBM</a> *db, int pagenum, int flags)</td></tr>
<tr class="memdesc:gaecf6514765dcfa0607706fce430612aa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mark entries clean/re-usable in the database for the specified page.  <a href="#gaecf6514765dcfa0607706fce430612aa">More...</a><br/></td></tr>
<tr class="separator:gaecf6514765dcfa0607706fce430612aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>The Data Management Group contains the API managing data as a whole (not record based), or on a large scale. </p>
<h2 class="groupheader">Typedef Documentation</h2>
<a class="anchor" id="ga3794540079294a018a304b1ae248006b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef int(* mdbm_clean_func)(<a class="el" href="mdbm_8h.html#a80768aab568ca444688a7a1dba7778cd">MDBM</a> *, const <a class="el" href="structdatum.html">datum</a> *, const <a class="el" href="structdatum.html">datum</a> *, struct <a class="el" href="structmdbm__clean__data.html">mdbm_clean_data</a> *, int *quit)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="gad01a846213e7f7782f0cf6896b0c24d7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mdbm_compress_tree </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="mdbm_8h.html#a80768aab568ca444688a7a1dba7778cd">MDBM</a> *&#160;</td>
          <td class="paramname"><em>db</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Compresses the existing MDBM directory. </p>
<p>Attempts to rebalance the directory and to compress the db to a smaller size.</p>
<p>NOTE: This function does not work with Windowed-Mode. For that use case, you should export your data and re-import it into a clean MDBM.</p>
<p>NOTE: Support for this feature in V4 should be considered experimental. Please run it on an offline DB, after making a backup of your uncompressed DB.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">db</td><td>Database handle </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ga11a0a94fd2e9ea5a385e3e54205e5831"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mdbm_truncate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="mdbm_8h.html#a80768aab568ca444688a7a1dba7778cd">MDBM</a> *&#160;</td>
          <td class="paramname"><em>db</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Truncates the MDBM to single empty page. </p>
<p>V3 WARNING: This loses the existing configuration information (ex. large object support or a hash function that was set other than the default).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">db</td><td>Database handle </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ga840fb9d7901f7e82630260850b5efc00"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mdbm_prune </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="mdbm_8h.html#a80768aab568ca444688a7a1dba7778cd">MDBM</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int(*)(<a class="el" href="mdbm_8h.html#a80768aab568ca444688a7a1dba7778cd">MDBM</a> *, <a class="el" href="structdatum.html">datum</a>, <a class="el" href="structdatum.html">datum</a>, void *)&#160;</td>
          <td class="paramname"><em>prune</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>param</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prunes an MDBM. </p>
<p>Iterates through the database calling the supplied prune function for each item in the database. Prune function:</p>
<div class="fragment"><div class="line">int (*prune)(<a class="code" href="mdbm_8h.html#a80768aab568ca444688a7a1dba7778cd">MDBM</a> *, <a class="code" href="structdatum.html">datum</a>, datum, <span class="keywordtype">void</span> *)</div>
</div><!-- fragment --><p>The user-supplied param pointer is passed as the 4th parameter to the prune function. If the prune function returns 1, the item is deleted. If the prune function returns 0, the item is retained.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">db</td><td>Database handle </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">prune</td><td>Prune function </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param</td><td>User supplied param, passed to prune function. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ga48eea2ca283989d42e42ca48720ebbd2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mdbm_purge </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="mdbm_8h.html#a80768aab568ca444688a7a1dba7778cd">MDBM</a> *&#160;</td>
          <td class="paramname"><em>db</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Purges (removes) all entries from an MDBM. </p>
<p>This does not change the MDBM's configuration or general structure.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">db</td><td>Database handle </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ga555f58328cbba5678b31b302c7478914"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mdbm_set_cleanfunc </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="mdbm_8h.html#a80768aab568ca444688a7a1dba7778cd">MDBM</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__DataManagementGroup.html#ga3794540079294a018a304b1ae248006b">mdbm_clean_func</a>&#160;</td>
          <td class="paramname"><em>func</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The specified cleaner function will be called by <a class="el" href="group__DataManagementGroup.html#gaecf6514765dcfa0607706fce430612aa">mdbm_clean</a>. </p>
<p>It can be called by <a class="el" href="group__RecordAccessGroup.html#ga5107f4235ad6ac1d9d4e73837f41a200">mdbm_store</a> should space be needed on a page. <a class="el" href="group__RecordAccessGroup.html#ga5107f4235ad6ac1d9d4e73837f41a200">mdbm_store</a> will call it if there is no registered shake function (see <a class="el" href="group__ConfigurationGroup.html#gafb7b88fcd40a3971136dc88ecfea0cab">mdbm_limit_size_v3</a>) or the registered shake function does not clear enough space for the store. An entry marked clean means it may be re-used to store new data.</p>
<p>NOTE: V3 API</p>
<p>The clean function is typedef'd like the following:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> int (*<a class="code" href="group__DataManagementGroup.html#ga3794540079294a018a304b1ae248006b">mdbm_clean_func</a>)(<a class="code" href="mdbm_8h.html#a80768aab568ca444688a7a1dba7778cd">MDBM</a> *, <span class="keyword">const</span> datum*, <span class="keyword">const</span> datum*,</div>
<div class="line">                              <span class="keyword">struct </span><a class="code" href="structmdbm__clean__data.html">mdbm_clean_data</a> *,</div>
<div class="line">                              <span class="keywordtype">int</span>* quit);</div>
</div><!-- fragment --><p>When the mdbm_clean_func is called to check an entry on a page, it will be passed the data parameter from the call to mdbm_set_cleanfunc.</p>
<p>The quit parameter is used by callers of the mdbm_clean_func to determine whether other entries on the page should be cleaned. If the mdbm_clean_func sets quit to true (non 0) then no other entries on the page will be checked for cleaning. Otherwise <a class="el" href="group__DataManagementGroup.html#gaecf6514765dcfa0607706fce430612aa">mdbm_clean</a> or <a class="el" href="group__RecordAccessGroup.html#ga5107f4235ad6ac1d9d4e73837f41a200">mdbm_store</a> will continue checking entries on the page to determine if they can be re-used/cleaned.</p>
<p>The mdbm_clean_func should return true (non 0) if the key/value may be re-used, AKA clean. IMPORTANT: To enable this feature cache mode must be set on the database. Ex: </p>
<div class="fragment"><div class="line"><a class="code" href="group__CacheAndBackingStoreGroup.html#ga2db305e8a4d47c50f82f6803c818904a" title="Manage the database as a cache.">mdbm_set_cachemode</a>(dbh, <a class="code" href="group__CacheAndBackingStoreGroup.html#ga7e39c53bd7124272842e8bf298b997a3" title="add to cachemode to evict clean items 1st">MDBM_CACHEMODE_EVICT_CLEAN_FIRST</a>|<a class="code" href="group__CacheAndBackingStoreGroup.html#ga96ea711f6ee1bac77334d3eed1dbe77e" title="Greedy dual-size frequency (size and frequency) eviction.">MDBM_CACHEMODE_GDSF</a>);</div>
<div class="line"><a class="code" href="group__DataManagementGroup.html#ga555f58328cbba5678b31b302c7478914" title="The specified cleaner function will be called by mdbm_clean.">mdbm_set_cleanfunc</a>(dbh, mycleanerfunction, mycleanerdata);</div>
<div class="line">mdbm_limit_size(dbh, limitNumPages, 0); <span class="comment">// notice no shake function is specified</span></div>
</div><!-- fragment --><p>Both of the cache mode flags are required. The second flag(MDBM_CACHEMODE_GDSF) used in the example can be replaced by MDBM_CACHEMODE_LFU or MDBM_CACHEMODE_LRU.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">db</td><td>Database handle </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">func</td><td>User-provided function to determine re-use of an entry </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">data</td><td>Opaque data passed to the user-provided function <em>func</em> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Set clean function status </dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">-1</td><td>Error, and errno is set </td></tr>
    <tr><td class="paramname">0</td><td>Success </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="gaecf6514765dcfa0607706fce430612aa"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mdbm_clean </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="mdbm_8h.html#a80768aab568ca444688a7a1dba7778cd">MDBM</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>pagenum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Mark entries clean/re-usable in the database for the specified page. </p>
<p>If pagenum is -1, then clean all pages. It relies on the user provided callback function set via <a class="el" href="group__DataManagementGroup.html#ga555f58328cbba5678b31b302c7478914">mdbm_set_cleanfunc</a> to determine re-usability/cleanliness of an entry. To be clean means an entry can be re-used to store new data.</p>
<p>NOTE: V3 API</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">db</td><td>Database handle </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pagenum</td><td>Page number to start cleaning. If &lt; 0, then clean all pages in the database. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">flags</td><td>Ignored </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Clean status or count </dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">-1</td><td>Error </td></tr>
    <tr><td class="paramname">Number</td><td>of cleaned entries </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- doc footer -->
</body>
</html>
