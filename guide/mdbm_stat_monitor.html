

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>mdbm_stat_monitor.pl &mdash; MDBM Developer Guide 4.3.0
 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="MDBM Developer Guide 4.3.0
 documentation" href="index.html" />
    <link rel="up" title="Tools" href="tools.html" />
    <link rel="next" title="mdbm_big_data_builder.pl" href="mdbm_big_data_builder.html" />
    <link rel="prev" title="mdbm_get_config" href="mdbm_get_config.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="mdbm_big_data_builder.html" title="mdbm_big_data_builder.pl"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="mdbm_get_config.html" title="mdbm_get_config"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">MDBM Developer Guide 4.3.0
 documentation</a> &raquo;</li>
          <li><a href="tools.html" accesskey="U">Tools</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <span class="target" id="mdbm-stat-monitor"></span><div class="section" id="mdbm-stat-monitor-pl">
<h1>mdbm_stat_monitor.pl<a class="headerlink" href="#mdbm-stat-monitor-pl" title="Permalink to this headline">¶</a></h1>
<div class="section" id="synopsis">
<h2>SYNOPSIS<a class="headerlink" href="#synopsis" title="Permalink to this headline">¶</a></h2>
<p>mdbm_stat_monitor.pl [-dh] -s <em>ymon-scoreboard-name</em> <em>JSON-file</em> ...</p>
</div>
<div class="section" id="description">
<h2>DESCRIPTION<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="docutils literal"><span class="pre">mdbm_stat_monitor.pl</span></tt> script uses <a class="reference internal" href="mdbm_stat.html#mdbm-stat"><em>mdbm_stat</em></a> to extract MDBM structure
and data characteristics for one or more MDBMs.</p>
<p>Metric values are emitted to a ymon scoreboard.  These Metrics are emitted
according to various ordered dimensions defined by A JSON file.  If the the
metrics for multiple MDBMs are being emitted to the same scoreboard, all MDBMs
must use that same setup for dimensions.  For example, if one JSON file
specifies dataset-name, partition number, and replication number dimensions,
then all JSON files must the same dimensions, and in the same order.</p>
<p>Applications should use a cron job to publish these metrics on a regular
interval to assist in MDBM capacity planning.</p>
<p>A JSON file contains:</p>
<blockquote>
<div><ul>
<li><p class="first">An MDBM path</p>
</li>
<li><p class="first">Whether or not to lock the MDBM when using mdbm_stat</p>
</li>
<li><dl class="first docutils">
<dt>A set of ordered dimensions (minimum of 1 dimension, <em>dataset name</em>, is required).</dt>
<dd><ul class="first last simple">
<li>dataset name</li>
<li>partition number</li>
<li>replica number</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">(optional) A page utilization percentage for it to be considered full.
This used is computing metrics for MDBM fullness.</p>
</li>
</ul>
</div></blockquote>
<p>A sample JSON file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span>
  <span class="s">&quot;mdbmPath&quot;</span> <span class="p">:</span> <span class="s">&quot;foo.mdbm&quot;</span><span class="p">,</span>
  <span class="s">&quot;lockMdbm&quot;</span> <span class="p">:</span> <span class="n">false</span><span class="p">,</span>
  <span class="s">&quot;fullPercent&quot;</span> <span class="p">:</span> <span class="mi">85</span><span class="p">,</span>
  <span class="s">&quot;dimensions&quot;</span> <span class="p">:</span> <span class="p">[{</span><span class="s">&quot;dataset&quot;</span> <span class="p">:</span> <span class="s">&quot;somedataset&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s">&quot;partition&quot;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">},</span> <span class="p">{</span><span class="s">&quot;replica&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">}]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="options">
<h2>OPTIONS<a class="headerlink" href="#options" title="Permalink to this headline">¶</a></h2>
<table class="docutils option-list" frame="void" rules="none">
<col class="option" />
<col class="description" />
<tbody valign="top">
<tr><td class="option-group">
<kbd><span class="option">-d</span>, <span class="option">--debug</span></kbd></td>
<td>Display debug information.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-h</span>, <span class="option">--help</span></kbd></td>
<td>Shows this help message.</td></tr>
<tr><td class="option-group" colspan="2">
<kbd><span class="option">-s</span>, <span class="option">--scoreboard <var>ymon-scoreboard-name</var></span></kbd></td>
</tr>
<tr><td>&nbsp;</td><td>ymon scoreboards reside in /home/y/var/scoreboards/.
Only the basename is used from the ymon-scoreboard parameter.</td></tr>
</tbody>
</table>
<dl class="docutils">
<dt><em>JSON-file</em></dt>
<dd>JSON format files describing ymon metric dimensions for an MDBM.
Use multiple JSON files if there are multiple MDBMs.
If stats are emitted for multiple MDBMs, they must all use the same dimensions.
The JSON &#8220;mdbmPath&#8221; and &#8220;dimensions&#8221; settings are required.
The JSON &#8220;dimensions&#8221; setting must specify at least 1 dimension.</dd>
</dl>
</div>
<div class="section" id="return-value">
<h2>RETURN VALUE<a class="headerlink" href="#return-value" title="Permalink to this headline">¶</a></h2>
<p>Returns 0 upon success, non-zero upon failure.</p>
</div>
<div class="section" id="output">
<h2>OUTPUT<a class="headerlink" href="#output" title="Permalink to this headline">¶</a></h2>
<p>Metric values are emitted to a <em>ymon-scoreboard-name</em>.</p>
<p>In the following table, <em>normal</em> pages are pages that are <em>not</em> used for large
objects or oversized pages.</p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="8%" />
<col width="14%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Metric Name</th>
<th class="head">YMon
Metric</th>
<th class="head">Aggregation</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>MstatBigPgFull</td>
<td>stat</td>
<td>last</td>
<td>A very rough measure for the number of LOOP pages near
full.  This count reflects the number of rows (not the
number of pages) in the histogram data that are greater
than or equal to the JSON &#8220;fullPercent&#8221; parameter
(default is 85%).  The &#8220;max&#8221; value in the histogram&#8217;s
&#8220;Bytes&#8221; column is used calculate this percentage.</td>
</tr>
<tr class="row-odd"><td>MstatFrPg</td>
<td>stat</td>
<td>last</td>
<td>Free pages count</td>
</tr>
<tr class="row-even"><td>MstatKeyAvg</td>
<td>stat</td>
<td>last</td>
<td>Key average bytes</td>
</tr>
<tr class="row-odd"><td>MstatKeyMax</td>
<td>stat</td>
<td>last</td>
<td>Key maximum bytes</td>
</tr>
<tr class="row-even"><td>MstatKeyMin</td>
<td>stat</td>
<td>last</td>
<td>Key minimum bytes</td>
</tr>
<tr class="row-odd"><td>MstatKvAvg</td>
<td>stat</td>
<td>last</td>
<td>Key+Value average bytes</td>
</tr>
<tr class="row-even"><td>MstatKvMax</td>
<td>stat</td>
<td>last</td>
<td>Key+Value maximum bytes</td>
</tr>
<tr class="row-odd"><td>MstatKvMin</td>
<td>stat</td>
<td>last</td>
<td>Key+Value minimum bytes</td>
</tr>
<tr class="row-even"><td>MstatLobAvg</td>
<td>stat</td>
<td>last</td>
<td>Large Object average bytes</td>
</tr>
<tr class="row-odd"><td>MstatLobEnt</td>
<td>stat</td>
<td>last</td>
<td>Large Object Store store entry count</td>
</tr>
<tr class="row-even"><td>MstatLobMax</td>
<td>stat</td>
<td>last</td>
<td>Large Object maximum bytes</td>
</tr>
<tr class="row-odd"><td>MstatLobMin</td>
<td>stat</td>
<td>last</td>
<td>Large Object minimum bytes</td>
</tr>
<tr class="row-even"><td>MstatLobSz</td>
<td>stat</td>
<td>last</td>
<td>Large Object store entry bytes</td>
</tr>
<tr class="row-odd"><td>MstatNormEnt</td>
<td>stat</td>
<td>last</td>
<td>Normal store entry count</td>
</tr>
<tr class="row-even"><td>MstatNormPgFull</td>
<td>stat</td>
<td>last</td>
<td>A very rough indicator for the number of normal
(non-LOOP) pages near full.  This count reflects the
number of rows (not the number of pages) in the
histogram data that are greater than or equal to
the JSON &#8220;fullPercent&#8221; parameter (default is 85%).
The &#8220;max&#8221; value in the histogram&#8217;s &#8220;Bytes&#8221; column is
used calculate this percentage.</td>
</tr>
<tr class="row-odd"><td>MstatNormSz</td>
<td>stat</td>
<td>last</td>
<td>Normal store entry bytes</td>
</tr>
<tr class="row-even"><td>MstatOvhSz</td>
<td>stat</td>
<td>last</td>
<td>Overhead bytes</td>
</tr>
<tr class="row-odd"><td>MstatPgEntAvg</td>
<td>stat</td>
<td>last</td>
<td>Entries per page average count</td>
</tr>
<tr class="row-even"><td>MstatPgEntMax</td>
<td>stat</td>
<td>last</td>
<td>Entries per page maximum count</td>
</tr>
<tr class="row-odd"><td>MstatPgEntMin</td>
<td>stat</td>
<td>last</td>
<td>Entries per page minimum count</td>
</tr>
<tr class="row-even"><td>MstatTime</td>
<td>stat</td>
<td>last</td>
<td>Elapsed seconds to stat an MDBM</td>
</tr>
<tr class="row-odd"><td>MstatTotEnt</td>
<td>stat</td>
<td>last</td>
<td>Total entry count</td>
</tr>
<tr class="row-even"><td>MstatTotPg</td>
<td>stat</td>
<td>last</td>
<td>Total number of pages</td>
</tr>
<tr class="row-odd"><td>MstatTotSz</td>
<td>stat</td>
<td>last</td>
<td>Total bytes</td>
</tr>
<tr class="row-even"><td>MstatTotUtil</td>
<td>stat</td>
<td>last</td>
<td>Total bytes utilization, percentage</td>
</tr>
<tr class="row-odd"><td>MstatValAvg</td>
<td>stat</td>
<td>last</td>
<td>Value average bytes</td>
</tr>
<tr class="row-even"><td>MstatValMax</td>
<td>stat</td>
<td>last</td>
<td>Value maximum bytes</td>
</tr>
<tr class="row-odd"><td>MstatValMin</td>
<td>stat</td>
<td>last</td>
<td>Value minimum bytes</td>
</tr>
<tr class="row-even"><td>MstatUsedPg</td>
<td>stat</td>
<td>last</td>
<td>Used pages count</td>
</tr>
<tr class="row-odd"><td>MstatUnusedSz</td>
<td>stat</td>
<td>last</td>
<td>Unused bytes</td>
</tr>
</tbody>
</table>
<p>Unlike other metrics, MstatNormPgFull and MstatBigPgFull are not simply
extracted from stat output.  Instead, all of histogram data is evaluated to find
the various minimum free byte points.  That section of the histogram and the
configuration input (ex., percent of page is used) is used to determine the
number of pages approaching fullness.</p>
</div>
<div class="section" id="examples">
<h2>EXAMPLES<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="see-also">
<h2>SEE ALSO<a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h2>
<p>mdbm_check(1), mdbm_compare(1), mdbm_copy(1), mdbm_create(1),
mdbm_digest(1), mdbm_dump(1), mdbm_export(1), mdbm_fetch(1), mdbm_import(1),
mdbm_purge(1), mdbm_replace(1), mdbm_restore(1), mdbm_save(1), mdbm_stat(1),
mdbm_sync(1), mdbm_trunc(1)</p>
</div>
<div class="section" id="contact">
<h2>CONTACT<a class="headerlink" href="#contact" title="Permalink to this headline">¶</a></h2>
<p>mdbm-users &lt;<a class="reference external" href="mailto:mdbm-users&#37;&#52;&#48;yahoo-inc&#46;com">mdbm-users<span>&#64;</span>yahoo-inc<span>&#46;</span>com</a>&gt;</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">mdbm_stat_monitor.pl</a><ul>
<li><a class="reference internal" href="#synopsis">SYNOPSIS</a></li>
<li><a class="reference internal" href="#description">DESCRIPTION</a></li>
<li><a class="reference internal" href="#options">OPTIONS</a></li>
<li><a class="reference internal" href="#return-value">RETURN VALUE</a></li>
<li><a class="reference internal" href="#output">OUTPUT</a></li>
<li><a class="reference internal" href="#examples">EXAMPLES</a></li>
<li><a class="reference internal" href="#see-also">SEE ALSO</a></li>
<li><a class="reference internal" href="#contact">CONTACT</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="mdbm_get_config.html"
                        title="previous chapter">mdbm_get_config</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="mdbm_big_data_builder.html"
                        title="next chapter">mdbm_big_data_builder.pl</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/mdbm_stat_monitor.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="mdbm_big_data_builder.html" title="mdbm_big_data_builder.pl"
             >next</a> |</li>
        <li class="right" >
          <a href="mdbm_get_config.html" title="mdbm_get_config"
             >previous</a> |</li>
        <li><a href="index.html">MDBM Developer Guide 4.3.0
 documentation</a> &raquo;</li>
          <li><a href="tools.html" >Tools</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Yahoo! Inc..
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>