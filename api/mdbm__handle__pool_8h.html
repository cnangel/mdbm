<html lang="en">
<head>
<title>MDBM</title>
<link rel="stylesheet" href="style.css" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head>
<body>
<!-- Generated by Doxygen 1.8.3.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">mdbm_handle_pool.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="mdbm_8h_source.html">mdbm.h</a>&gt;</code><br/>
</div>
<p><a href="mdbm__handle__pool_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:af68a4eaa5d4fcac62ba7165fb3ed4b92"><td class="memItemLeft" align="right" valign="top">typedef struct mdbm_pool_s&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdbm__handle__pool_8h.html#af68a4eaa5d4fcac62ba7165fb3ed4b92">mdbm_pool_t</a></td></tr>
<tr class="separator:af68a4eaa5d4fcac62ba7165fb3ed4b92"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:af678b3018fd462964dc4c041d26a01ec"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdbm__handle__pool_8h.html#af678b3018fd462964dc4c041d26a01ec">mdbm_pool_parse_pool_size</a> (const char *value)</td></tr>
<tr class="memdesc:af678b3018fd462964dc4c041d26a01ec"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parse and return the configured pool size for the this process.  <a href="#af678b3018fd462964dc4c041d26a01ec">More...</a><br/></td></tr>
<tr class="separator:af678b3018fd462964dc4c041d26a01ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab1027c053b7802b7bf8620307d38e5fe"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdbm__handle__pool_8h.html#ab1027c053b7802b7bf8620307d38e5fe">mdbm_pool_verify_pool_size</a> (int *vals, int count)</td></tr>
<tr class="memdesc:ab1027c053b7802b7bf8620307d38e5fe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Verifies and returns updated values for number of handles in the pool.  <a href="#ab1027c053b7802b7bf8620307d38e5fe">More...</a><br/></td></tr>
<tr class="separator:ab1027c053b7802b7bf8620307d38e5fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a489ddf10948e8d77e6949a326409b007"><td class="memItemLeft" align="right" valign="top"><a class="el" href="mdbm__handle__pool_8h.html#af68a4eaa5d4fcac62ba7165fb3ed4b92">mdbm_pool_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdbm__handle__pool_8h.html#a489ddf10948e8d77e6949a326409b007">mdbm_pool_create_pool</a> (<a class="el" href="mdbm_8h.html#a80768aab568ca444688a7a1dba7778cd">MDBM</a> *db, int size)</td></tr>
<tr class="memdesc:a489ddf10948e8d77e6949a326409b007"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a pool of mdbm handles.  <a href="#a489ddf10948e8d77e6949a326409b007">More...</a><br/></td></tr>
<tr class="separator:a489ddf10948e8d77e6949a326409b007"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a838824a9c6cf1437da610d0afdc717d1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdbm__handle__pool_8h.html#a838824a9c6cf1437da610d0afdc717d1">mdbm_pool_destroy_pool</a> (<a class="el" href="mdbm__handle__pool_8h.html#af68a4eaa5d4fcac62ba7165fb3ed4b92">mdbm_pool_t</a> *pool)</td></tr>
<tr class="memdesc:a838824a9c6cf1437da610d0afdc717d1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Delete a mdbm handle pool.  <a href="#a838824a9c6cf1437da610d0afdc717d1">More...</a><br/></td></tr>
<tr class="separator:a838824a9c6cf1437da610d0afdc717d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9507198b363621060ee100fd6f3689a1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="mdbm_8h.html#a80768aab568ca444688a7a1dba7778cd">MDBM</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdbm__handle__pool_8h.html#a9507198b363621060ee100fd6f3689a1">mdbm_pool_acquire_handle</a> (<a class="el" href="mdbm__handle__pool_8h.html#af68a4eaa5d4fcac62ba7165fb3ed4b92">mdbm_pool_t</a> *pool)</td></tr>
<tr class="memdesc:a9507198b363621060ee100fd6f3689a1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Acquire an MDBM handle for database operations.  <a href="#a9507198b363621060ee100fd6f3689a1">More...</a><br/></td></tr>
<tr class="separator:a9507198b363621060ee100fd6f3689a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8f0088eecf5ab4d17e25dc847355afcc"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdbm__handle__pool_8h.html#a8f0088eecf5ab4d17e25dc847355afcc">mdbm_pool_release_handle</a> (<a class="el" href="mdbm__handle__pool_8h.html#af68a4eaa5d4fcac62ba7165fb3ed4b92">mdbm_pool_t</a> *pool, <a class="el" href="mdbm_8h.html#a80768aab568ca444688a7a1dba7778cd">MDBM</a> *db)</td></tr>
<tr class="memdesc:a8f0088eecf5ab4d17e25dc847355afcc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Release MDBM handle back to the pool.  <a href="#a8f0088eecf5ab4d17e25dc847355afcc">More...</a><br/></td></tr>
<tr class="separator:a8f0088eecf5ab4d17e25dc847355afcc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5805bc37cadec9f2f7f9467831bfee82"><td class="memItemLeft" align="right" valign="top"><a class="el" href="mdbm_8h.html#a80768aab568ca444688a7a1dba7778cd">MDBM</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdbm__handle__pool_8h.html#a5805bc37cadec9f2f7f9467831bfee82">mdbm_pool_acquire_excl_handle</a> (<a class="el" href="mdbm__handle__pool_8h.html#af68a4eaa5d4fcac62ba7165fb3ed4b92">mdbm_pool_t</a> *pool)</td></tr>
<tr class="memdesc:a5805bc37cadec9f2f7f9467831bfee82"><td class="mdescLeft">&#160;</td><td class="mdescRight">Acquire an exclusive MDBM handle for database operations.  <a href="#a5805bc37cadec9f2f7f9467831bfee82">More...</a><br/></td></tr>
<tr class="separator:a5805bc37cadec9f2f7f9467831bfee82"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae322926f666ddc7ecf25bcd6da4d8890"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdbm__handle__pool_8h.html#ae322926f666ddc7ecf25bcd6da4d8890">mdbm_pool_release_excl_handle</a> (<a class="el" href="mdbm__handle__pool_8h.html#af68a4eaa5d4fcac62ba7165fb3ed4b92">mdbm_pool_t</a> *pool, <a class="el" href="mdbm_8h.html#a80768aab568ca444688a7a1dba7778cd">MDBM</a> *db)</td></tr>
<tr class="memdesc:ae322926f666ddc7ecf25bcd6da4d8890"><td class="mdescLeft">&#160;</td><td class="mdescRight">Release an exclusive MDBM handle.  <a href="#ae322926f666ddc7ecf25bcd6da4d8890">More...</a><br/></td></tr>
<tr class="separator:ae322926f666ddc7ecf25bcd6da4d8890"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Typedef Documentation</h2>
<a class="anchor" id="af68a4eaa5d4fcac62ba7165fb3ed4b92"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct mdbm_pool_s <a class="el" href="mdbm__handle__pool_8h.html#af68a4eaa5d4fcac62ba7165fb3ed4b92">mdbm_pool_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="af678b3018fd462964dc4c041d26a01ec"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mdbm_pool_parse_pool_size </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>value</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Parse and return the configured pool size for the this process. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">value</td><td>configuration setting value. The format of the value is comma (,) separated list name=value pairs where name is the application basename (e.g. yapache, yjava_daemon) and the value is the number of handles in the pool.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Number of configured number of mdbm handles for the pool </dd></dl>

</div>
</div>
<a class="anchor" id="ab1027c053b7802b7bf8620307d38e5fe"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mdbm_pool_verify_pool_size </td>
          <td>(</td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>vals</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>count</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Verifies and returns updated values for number of handles in the pool. </p>
<p>The maximum useful size of handles is affected by both the maximum allowed number of open files (NOFILE) and the maximum number of processes (NPROC):</p>
<p>NOFILE limit: Each mdbm handle requires two open file entries (one for the db file and one for the lock file). Thus, if ynetdblib sees that the number of requested mdbm handles exceeds 3/4 of the maximum allowed number of open files ( determined by getrlimit(RLIMIT_NOFILE, ...), it will scale back accordingly.</p>
<p>NPROC limit: Since each thread requires only one mdbm handle, and not all threads need to open ynetdblib mdbm files, there is no good reason to support having as many handles as the maximum number of processes. Thus, if ynetdblib sees that the number of requested mdbm handles exceeds 3/4 of the maximum allowed number of processes (determined by getrlimit(RLIMIT_NPROC, ...) it will scale back accordingly.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">vals</td><td>integer array that includes the values to be checked. If the value is larger than the system limit as described above, the array is updated to reflect the new value </td></tr>
    <tr><td class="paramname">count</td><td>the number of integers in the vals array </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a489ddf10948e8d77e6949a326409b007"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="mdbm__handle__pool_8h.html#af68a4eaa5d4fcac62ba7165fb3ed4b92">mdbm_pool_t</a>* mdbm_pool_create_pool </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="mdbm_8h.html#a80768aab568ca444688a7a1dba7778cd">MDBM</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create a pool of mdbm handles. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">db</td><td>MDBM handle that will be duplicated </td></tr>
    <tr><td class="paramname">size</td><td>number of duplicated handles</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>pointer to newly created pool object. This object must destroyed using mdbm_pool_destroy_pool function. </dd></dl>

</div>
</div>
<a class="anchor" id="a838824a9c6cf1437da610d0afdc717d1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mdbm_pool_destroy_pool </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="mdbm__handle__pool_8h.html#af68a4eaa5d4fcac62ba7165fb3ed4b92">mdbm_pool_t</a> *&#160;</td>
          <td class="paramname"><em>pool</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Delete a mdbm handle pool. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pool</td><td>pointer to a pool object that was returned from calling mdbm_pool_create_pool function</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>1 if successful or 0 for failure. </dd></dl>

</div>
</div>
<a class="anchor" id="a9507198b363621060ee100fd6f3689a1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="mdbm_8h.html#a80768aab568ca444688a7a1dba7778cd">MDBM</a>* mdbm_pool_acquire_handle </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="mdbm__handle__pool_8h.html#af68a4eaa5d4fcac62ba7165fb3ed4b92">mdbm_pool_t</a> *&#160;</td>
          <td class="paramname"><em>pool</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Acquire an MDBM handle for database operations. </p>
<p>If there are no available handles in the pool, the function will block until there is one available.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pool</td><td>pointer to a pool object that was returned from calling mdbm_pool_create_pool function</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>pointer to MDBM handle or NULL for failure. The MDBM handle must be returned to the pool with the mdbm_pool_release_handle function </dd></dl>

</div>
</div>
<a class="anchor" id="a8f0088eecf5ab4d17e25dc847355afcc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mdbm_pool_release_handle </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="mdbm__handle__pool_8h.html#af68a4eaa5d4fcac62ba7165fb3ed4b92">mdbm_pool_t</a> *&#160;</td>
          <td class="paramname"><em>pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="mdbm_8h.html#a80768aab568ca444688a7a1dba7778cd">MDBM</a> *&#160;</td>
          <td class="paramname"><em>db</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Release MDBM handle back to the pool. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pool</td><td>pointer to a pool object that was returned from calling mdbm_pool_create_pool function </td></tr>
    <tr><td class="paramname">db</td><td>pointer to the MDBM handle to be released back to the pool. This pointer must have been acquired from the mdbm_pool_acquire_handle call.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>1 if successful or 0 for failure. </dd></dl>

</div>
</div>
<a class="anchor" id="a5805bc37cadec9f2f7f9467831bfee82"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="mdbm_8h.html#a80768aab568ca444688a7a1dba7778cd">MDBM</a>* mdbm_pool_acquire_excl_handle </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="mdbm__handle__pool_8h.html#af68a4eaa5d4fcac62ba7165fb3ed4b92">mdbm_pool_t</a> *&#160;</td>
          <td class="paramname"><em>pool</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Acquire an exclusive MDBM handle for database operations. </p>
<p>The original MDBM handle that was used for duplication is returned to the caller. The function guarnatees that all of the duplicated MDBM handles are in the pool and nobody is using them.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pool</td><td>pointer to a pool object that was returned from calling mdbm_pool_create_pool function</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>pointer to MDBM handle or NULL for failure. The MDBM handle must be returned to the pool with the mdbm_pool_release_handle function </dd></dl>

</div>
</div>
<a class="anchor" id="ae322926f666ddc7ecf25bcd6da4d8890"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mdbm_pool_release_excl_handle </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="mdbm__handle__pool_8h.html#af68a4eaa5d4fcac62ba7165fb3ed4b92">mdbm_pool_t</a> *&#160;</td>
          <td class="paramname"><em>pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="mdbm_8h.html#a80768aab568ca444688a7a1dba7778cd">MDBM</a> *&#160;</td>
          <td class="paramname"><em>db</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Release an exclusive MDBM handle. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pool</td><td>pointer to a pool object that was returned from calling mdbm_pool_create_pool function </td></tr>
    <tr><td class="paramname">db</td><td>pointer to the exclusive MDBM handle to be released. This pointer must have been acquired from the mdbm_pool_acquire_excl_handle call.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>1 if successful or 0 for failure. </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- doc footer -->
</body>
</html>
